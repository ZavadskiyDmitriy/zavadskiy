

Переименовал папки для корректной сортировки
Роман Макаров authored 3 months ago
3008e2ed
get-students
03-git
git.md
git.md
37.29 KiB
Цели и структура занятия
Полезные материалы
Теория
Git
Определения
Сервера Git. GitHub
SSH
Практика
Установка Git
Linux (RaspberryPi)
Mac OS
Windows
Основные команды git
Начало работы
Первый коммит
Где коммит?
Работа с SSH-ключами в терминале
Создаём ключи
Добавляем ключи в агента SSH
Работа в удаленном репозитории. GitHub
Добавляем ключ на GitHub
Создаём репозиторий на GitHub
Клонируем репозиторий
Задания
Задача №1. Первый коммит
Задача №2. Первая ветка
Задача №3. Первое слияние веток
Задача №4. Второй репозиторий
Цели и структура занятия
Тэги: git, github

На протяжении предыдущих занятий вы создавали код для работы с RaspberryPi, который хранится на ваших малинках. Хорошо, если он хранится в одном месте и за два занятия никуда и не потерялся. Переписывать код каждый раз заново, даже если вы знаете как его написать, не самый эффективный подход. Лучше всего пользоваться предыдущими наработками и вносить в них изменения или добавлять новый код. Самый надёжный и эффективный способ хранить и изменять код — репозитории в облаке.

Репозиторий поможет вам следить за версиями проекта, создавать разные ветки развития проекта, откатываться до старых версий.

Облако поможет вам не потерять код, делиться им с другими людьми и разрабатывать проекты вместе с ними. Облачным хранилищем кода на этом занятии будет выступать GitHub.

Система хранения Git практически стала стандартом в информационных технологиях, и опыт работы с Git требуется в очень многих областях. Поэтому чем раньше вы начнёте работать с Git, тем раньше приобретете важный и полезный навык!

Нужно научиться:

генерировать ssh ключ
пользоваться ssh ключом
создавать репозиторий на сайте GitHub
клонировать репозиторий
коммитить
создавать ветки
сливать ветки
отправлять изменения на сервер
получать изменения с сервера
Полезные материалы
Материалы к этому занятию покрывают основы работы с системой Git, по которой в интернете уже существует масса курсов, статей и гайдов. Мы постарались собрать самое полезное и нужное в нашем материале. Но если вам этого недостаточно, то ниже представлены полезные ссылки, по которым вы сможете узнать гораздо больше:

Официальная страница git-scm

Онлайн-книга по работе с Git — информацию по занятию взята из этой книги

Онлайн-урок по Git — самый эффективный способ понять как работать с Git

Теория
Git
Git — это распределенная система контроля версий. Система Git была создана Линусом Торвальдсом в 2005 году во время разработки ядра Linux, и решала одну конкретную задачу: совместная разработка кода ядра Linux. До Git командой разработки использовалась BitKeeper, но столкнувшись с проблемами при его использовании, Линус Торвальдс решил написать свою систему контроля версий.

Первый коммит в системе git в репозиторий ядра Linux::Tag

linux-kernel

Давайте разберемся и поймём, что же такое распределенная система контроля версий? Для этого нам надо понять, какие еще системы контроля версий бывают.

Локальные системы контроля версий (ЛСКВ) Некоторые люди в качестве метода контроля версий применяют копирование файлов в отдельную директорию,возможно даже в директорию с отметкой по времени для большего контроля. Данный подход всё ещё очень популярен и распространён. Изменения сохраняются в виде наборов патчей, где каждый патч датируется и получает отметку времени. Таким образом, если код перестаёт работать, наборы патчей можно совместить, чтобы получить исходное состояние файла.

Централизованные системы контроля версий (ЦСКВ) ЦСКВ были созданы для решения проблемы взаимодействия с другими разработчиками. Такие системы имеют единственный сервер, содержащий все версии файлов, и некоторое количество клиентов, которые получают файлы из этого централизованного хранилища и там же их сохраняют. Тем не менее, такой подход имеет существенный недостаток — выход сервера из строя обернётся потерей всех данных.

Распределённые системы контроля версий (РСКВ) РСКВ избавили пользователей от недостатка ЦСКВ, клиенты РСКВ не просто скачивают снимок всех файлов (состояние файлов на определённый момент времени), а полностью копируют репозиторий. Это значит, что у каждого клиента есть копия всего исходного кода и внесённых изменений. В этом случае, если один из серверов выйдет из строя, любой клиентский репозиторий может быть скопирован на другой сервер для продолжения работы. Ещё одним преимуществом РСКВ является то, что они могут одновременно взаимодействовать с несколькими удалёнными репозиториями, что означает, что вы можете параллельно работать над несколькими проектами.

Получается, что в этой системе мы можем хранить набор разных версий кода и обмениваться всем набором изменений с сервером.

Определения
Нам необходимо ввести некоторые определения для работы с Git, которые будут справделивы для всех операционных систем.

Локальная база данных git, локальный репозиторий (repository) — это набор файлов, в которых хранится информация о всех версиях файлов директории, в которой создан репозиторий. Файлы локальной базы данных хранятся в директории (папке) .git.

:warning:️ Очень важно НЕ вносить изменения в эту папку вручную !

branch (ветка) — перемещаемый указатель на фиксированную версию в локальном или удалённом репозитории. По умолачанию создаётся ветка master или main

Состояние файлов:

modified (модифицированный) — файл, который изменил содержание по отношению к предыдующей зафиксированной версии, но еще не проиндексирован;

staged (индексированный) — файл, отмеченный для включения в следующую версию;

commited (зафиксированный) — файл, зафиксированный в локальной базе данных в данной версии;

Действия:

commit (фиксирование версии, коммит) — добавление проиндексированных файлов в локальную базу данных;

merge (слияние) — добавление изменений одной фиксированной версии к другой;

clone (клонирование) — копирует удаленную базу данных на локальный компьютер, тем самым создавая локальную базу данных;

push (отправка) — отправляет версий из вашего локального репозиторий на удалённый репозиторий;

fetch (получение) — получает информацию о зафиксированных версиях из удаленного репозитория;

pull (вытягивание) — получает информацию о зафиксированных версиях и выполняет слияние текущей локальной версии и последней из полученных версий из уделнного репозитория

Сервера Git. GitHub
Если вы разрабатываете проект в команде, то хотелось бы, чтобы все участники команды имели одновременный доступ к репозиторию. Проще всего это сделать, разместив ваш код на сервере, имеющем доступ к глобальной сети Интернет.

На сервере должен хранится репозиторий, такой же как и у вас на локальном компьютере, а доступ к нему должен осуществляться при помощи разных протоколов: SSH, HTTP, HTTPS.

Но для этого у вас должен быть в распоряжении такой сервер. Более того, вы должны уметь его настраивать, поддерживать и следить за тем, чтобы проходящий мимо кот не нажал на кнопку выключения питания в самый ответственный момент.

Ответственность за хранение данных можно переложить на сервисы, которые занимаются хранением репозиториев, например GitHub.

GitHub

Он позволяет создавать репозитории, давать людям доступ к нему, определять, кто может изменять код в вашем репозитории, создавать команды, задачи, ставить лайки (в случае репозиториев это звезды). В общем, GitHub уже давно стал больше чем место, где хранится код. Это целая экосистема для разработки проектов, которая помогает командам создавать классные продукты и делиться ими со всем миром, а мир может им помочь сделать их продукт еще лучше.

Помимо GitHub есть система GitLab, которую вы можете установить на свой сервер. Минус в том, что вы должны уметь обслуживать сервер, плюс в том, что все остальные задачи (подобные тем, что решает GitHub) уже решены в GitLab.

GitLab

SSH
Мы поняли, что у нас есть репозиторий Git. Этот репозиторий хранится на некотором сервере (вашем личном, или GitHub). Как же безопасно обмениваться с репозиторием на этом сервере вашими изменениями версий? Проблема безопасного обмена информацией с сервером решается при помощи протокола SSH.

SSH (Secure SHell, защищенная оболочка) — это протокол, который позволяет получать доступ к командам операционной системы по зашифрованному каналу данных. То есть те, команды которые вы выполняете в терминале у себя на локальном компьютере (ls, cd и т.д.), вы можете так же при помощи этого протокола выполнить на любом другом компьютере если будете иметь к нему доступ.

Доступ можно получить либо зная имя пользователя и пароль, либо при помощи SSH RSA-ключа. Второй способ является предпочтительным, и на данный момент подключится к GitHub только на основании логина и пароля невозможно.

Чтобы подключится к серверу, вам необходимо создать пару RSA-ключей: публичный и приватный. Публичный ключ вы можете отправлять на сервера, к которым будете подключаться. Приватный ключ вы должны держать в секрете, на него можно даже установить пароль, так что даже если кто-то скопирует ваш приватный ключ, то этот кто-то не сможет им воспользоваться.

Шифрование данных в SSH происходит в два этапа. При подключении к серверу при помощи ассимитричного шифрования вы обмениваетесь сеансовым ключом (такой ключ, которым будут шифроваться данные на протяжении сеанса), который сервер зашифровывает публичным ключом, а вы расшифровываете приватным. После обмена сеансовым ключом все сообщения шифруются именно им при помощи симметричного шифрования. Вы никак не влияете на сеансовый ключ, эти подробности нужны лишь для общего понимания принципов работы SSH.

Практика
Установка Git
Описание установки для всех систем в онлайн-книге

Linux (RaspberryPi)
По умолчанию в Linux уже установлен git. Работа с Git осуществляется в терминале.

Mac OS
Самый простой способ установить Git, это воспользоваться менеджером пакетов Homebrew.

Откройте окно терминала, набрав Command + Пробел, чтобы открыть Spotlight, а затем введите слово "терминал" в поле поиска. Выберите программу "Терминал", нажав Enter.

Теперь скопируйте и вставьте следующую команду в окно терминала, чтобы установить Homebrew.

/usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"

Нажмите Return и разрешить установку Homebrew. Когда она завершится, у вас будет установлен Git в Mac OS, поскольку он является неотъемлемой частью Homebrew.
Работа с Git осуществляется в терминале.

Windows
Ссылка на скачивание установочного файла

Работа будет происходить в терминале Git Bash. Эту программу можно найти в меню "Пуск".

Основные команды git
Начало работы
При работе в Linux или MacOS необходимо открыть терминал. При работе в Windows необходимо запустить программу Git Bash, только в ней команды будут совпадать с командами из Linux и MacOS.

Если вы только установили Git, то необходимо сообщить своё имя и email системе Git, чтобы она подписывала ваши коммиты.

git config --global user.name "Имя Фамилия"
git config --global user.email "имя.фамилия@phystech.edu"
Также можно указать, каким текстовым редактором вы хотите пользоваться при редактировании текста коммитов. Если вы не знаете, что такое Vim, то лучше всего ввести следующую строчку, тогда вы выберете редактор nano, который более дружелюбен к новым пользователям:

git config --global core.editor nano
Теперь мы готовы создать репозиторий и сделать первый коммит. Для этого необходимо создать папку, в которой будет располагаться репозиторий. Репозиторий создаётся при помощи команды:

git init

Вот как выглядят выше описанные действия в командной строке:

git-init

Первый коммит
Создадим в репозитории текстовый файл README.md, напишем в него: "Hello, World!" и закоммитим.

Создать файл в терминале можно при помощи команды: nano README.md

Это команда создаст файл и откроет его в текстовом редакторе nano. Этот текстовый редактор встроен в терминал, у него нет графического представления. Так что после выполнения программы ваше окно терминала будет выглядеть примерно вот так:

nano-readme

Просто напишите текст и нажмите Ctrl+W, чтобы записать файл на диск. Нажмите Ctrl+X, чтобы выйти.

Теперь посмотрим статус нашего репозитория:

git status

git-status

Команда статус сообщает нам, что мы находимся в ветке master. Что подготовленных для фиксирования версии файлов. И файл Readme.md непроиндексирован.

Проиндексируем файл Readme.md при помощи команды

git add Readme.md

git-add

Теперь мы видим, что наши изменения проиндексированы и готовы для комита. Чтобы выполнить коммит (зафиксировать текущую версию):

git commit

Если вы поменяли редактор в начале работы на nano, то вам откроется окно текстового редактора, в котором необходимо написать сообщение к git коммиту. После этого сохранить сообщение при помощи Ctrl-O и закрыть при помощи Ctrl-X. Можем опять спросить статус и увидеть, что модифицированных файлов в текующем состоянии репозитория нет.

git-commit

Где коммит?
Чтобы точно убедится, что наша версия появилась в репозитории выполним команду (Если лог длинный, чтобы выйти из просмотра лога ввведите сначала :, потом нажмите q):

git log

git-log

Эта команда выводит лог репозитория, а точнее описание нескольких последних комитов (зафиксированных версий) в репозитории. Также можно увидеть кто сделал комит и когда.

Важно, что нам выводится хэш комита. Хэши не повторяются и однозначно указывают на конкретную зафиксированную версию в репозитории. Это будет важно, когда мы захотим переключаться на конкретный коммит, сделать это можно только по хэшу.

Дальше идёт надпись HEAD -> master. HEAD — это указатель на ту версию, относительно которой будут фиксироваться изменения. А конкретная надпись означает, что следующие изменения будут фиксироваться относительно последней версии в ветке master

Если ваш репозиторий слишком большой, то лучше воспользоваться командой:

git log —all —decorate —oneline —graph

Запомнить эту команду поможет мем:

git-log-adog

Можно также сохранить короткое имя для этой команды:

git config --global alias.adog "log --all --decorate --oneline --graph"

И вызывать ее командой:

 git adog

Поздравляем! Теперь вы можете фиксировать разные версии ваших файлов и не переживать, что что-то сломается. Но пока мы научились делать это только локально и в одной ветке. Дальше мы разберемся как нам работать с удалённым репозиторием на сервере и разными ветками.

Работа с SSH-ключами в терминале
Создаём ключи
Прежде чем начать работать в GitHub нам нужно создать публичный и приватный ключ. Делается это при помощи программы-генератора ключей, например ssh-keygen. Но сначала давайте посмотрим, есть ли у нас уже созданные ключи:

ls ~/.ssh

Команда ls показывает файлы и папки в директории. Символ ~ является указателем на домашнюю директорию, это такая директория, в которой хранятся данные пользователя. Дальше указывается путь папки .ssh относительно домашней директории, в этой папке сохраняются ваши созданные ключи, а также другие настройки ssh-клиента.

Давайте создадим наш первый ключ при помощи команды:

ssh-keygen -t ed25519 -C "имя.фамилия@phystech.edu"

Где ed25519 это просто формат ключа, а после ключа -C идёт ваш email.

Программа предложит вам переименовать ключ, можно отказаться (его можно переименовать позже) и попросит ввести пароль для ключа (его можно оставить пустым). Теперь если вы еще раз выполнить команду ls ~/.ssh, то должны увидеть там два файла id_ed25519 и id_ed25519.pub. Это просто текстовое представление некоторого очень большого числа. Вывести значение ключа на экран можно при помощи команды:

cat ~/.ssh/id_ed25519.pub

Добавляем ключи в агента SSH
Ключи созданы, но наш клиент SSH не знает какой ключ использовать для подключения. Эту информацию клиенту SSH может предоставить программа ssh-agent. Чтобы запустить ее нужно выполнить в терминале команду:

eval "$(ssh-agent -s)"

А после добавить в агента ваш ключ при помощи команды:

ssh-add ~/.ssh/id_ed25519 Последние две команды необходимо выполнять каждый раз при перезапуске терминала.

Отлично! Теперь мы готовы получать данные из удаленного репозитория.

Работа в удаленном репозитории. GitHub
Добавляем ключ на GitHub
Сначала вам необходимо создать учетную запись на сайте GitHub. Надеюсь, что вы справитесь с этим сами.

После того как вы создали учётную запись необходимо добавить ваш публичный ключ в настройки пользователя. Для этого наведите на вашу иконку в правом верхнем углу, выберите пункт Settings, найдите слева пункт SSH and GPG keys, нажмите на кнопку New SSH key.

Откроется окно, в котором можно ввести название в поле Title. В поле Key нужно вставить публичный ключ. Его можно получить при помощи команды на вашем компьютере cat ~/.ssh/id_ed25519.pub. Скопируйте ключ из терминала, и вставьте его, после чего нажмите Add SSH key.

После этого ключ должен отражаться в списке ключей. Чтобы проверить правильно ли вы всё сделали вызовите команду:

ssh -T git@github.com

Она должна вернуть

Hi <username>! You've successfully authenticated, but GitHub does not provide shell access.

Создаём репозиторий на GitHub
В правом верхнем углу наводим на плюсик и выбираем New Repository. Придумываем название, описание, делаем его публичным и нажимаем Create repository. Теперь во вкладке Your Repositories под вашей иконкой, должен появится ваш репозиторий, выберете его в списке. Когда он откроется нажмите на кнопку Code в ней выбираем вкладку SSH в строке ниже есть строчка, которая начинается с git@github.com... — это адрес вашего репозитория по протоколу SSH. Скопируйте ее.

Клонируем репозиторий
Если вы находитесь в папке с другим репозиторием, то выйдите из нее. Не стоит клонировать репозиторий в другой репозиторий!

Теперь необходимо получить созданный репозиторий. Это можно сделать при помощи команды, где в <url> вставьте адрес репозитория:

git clone <url>

После этого в текущей папке появится папка с названием вашего репозитория. Отлично!

Если вы всё это время повторяли действия описанные выше, то пришла пора перейти к выполнению заданий, так как проще всего разобраться с Git на практике!